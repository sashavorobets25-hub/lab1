import random
import string

# Функція створює текстовий файл із випадковими літерами.
# Параметри:
#   filename – ім'я файлудл
#   lines_count – кількість рядків у файлі (мінімум 100 за умовою)
#   line_length – кількість символів у кожному рядку (мінімум 100)
def create_random_file(filename, lines_count=101, line_length=120):
    """Створює файл з випадковими літерами."""
    # Відкриваємо файл у режимі запису ('w'), якщо його не існує – буде створений.
    # encoding='utf-8' – стандартне кодування для текстових файлів.
    with open(filename, "w", encoding="utf-8") as f:

        # Створюємо задану кількість рядків
        for _ in range(lines_count):

            # Генеруємо один рядок:
            # random.choice(string.ascii_lowercase) – випадкова літера a-z
            # Вираз у дужках створює 120 випадкових букв.
            # ''.join(...) перетворює список букв у одну строку.
            line = ''.join(random.choice(string.ascii_lowercase) for _ in range(line_length))

            # Записуємо сформований рядок у файл + перехід на новий рядок
            f.write(line + "\n")


# Генератор, який читає файл пострічково
# та рахує кількість появ визначених пар букв у кожному рядку.
#
# Параметри:
#   filename – файл, який аналізуємо
#   pairs_list_per_line – список, де кожному рядку файлу відповідає ТРИ пари букв
def count_pairs(filename, pairs_list_per_line):
    """Генератор, який рахує пари букв всередині рядків."""

    try:
        # Відкриваємо файл у режимі читання
        with open(filename, 'r', encoding='utf-8') as f:

            # enumerate(f) повертає номер рядка (line_index) і сам рядок (line)
            for line_index, line in enumerate(f):

                # Обираємо 3 пари букв, які були згенеровані для цього рядка
                # Наприклад ['ab', 'cd', 'ef']
                pairs = pairs_list_per_line[line_index]

                # Створюємо словник, де ключ – пара букв, значення – лічильник
                # Спочатку лічильник кожної пари дорівнює 0
                pair_counts = {p: 0 for p in pairs}

                # .strip() – забирає зайві пробіли і символ \n
                # .split() – розділяє рядок по пробілах на слова
                # У нас слова немає (рядок без пробілів), тому вийде список з одним "словом" довжиною 120 букв
                words = line.strip().split()

                # Аналізуємо кожне слово в рядку (фактично один елемент)
                for word in words:
                    # Переводимо в нижній регістр (на всяк випадок)
                    word = word.lower()

                    # Ітеруємо по всіх можливих позиціях для отримання дволітерних пар
                    # Наприклад у слові "abcdef":
                    #   i = 0 → "ab"
                    #   i = 1 → "bc"
                    #   i = 2 → "cd"
                    #   i = 3 → "de"
                    #   i = 4 → "ef"
                    for i in range(len(word) - 1):
                        
                        # Беремо два символи підряд – це і є пара букв
                        pair = word[i:i+2]

                        # Якщо ця пара входить у список 3 пар для цього рядка – збільшуємо лічильник
                        if pair in pair_counts:
                            pair_counts[pair] += 1

                # yield повертає результат для цього рядка
                # але не завершує функцію – генератор продовжить роботу при наступному виклику next()
                yield pair_counts

    # Обробка можливих помилок (наприклад: файл не знайдено)
    except Exception as e:
        print(f"Помилка: {e}")
        return



# Основна функція, яка керує роботою програми
def main():
    FILE = "random_text.txt"

    # 1. Створюємо текстовий файл з випадковими рядками
    create_random_file(FILE)

    # 2. Створюємо список зі 101 елемента,
    #    де кожен елемент – це список з трьох унікальних пар букв.
    all_pairs = []
    letters = string.ascii_lowercase  # 'abcdefghijklmnopqrstuvwxyz'

    # Генеруємо 3 різні пари для кожного рядка
    for _ in range(101):

        # Використовуємо множину (set), щоб не було дублювання пар
        three_pairs = set()

        # Поки не зберемо рівно 3 різні пари – генеруємо нові
        while len(three_pairs) < 3:
            # Випадково беремо дві літери → створюємо пару
            pair = random.choice(letters) + random.choice(letters)
            # Додаємо у set – дублікати автоматично відсіюються
            three_pairs.add(pair)

        # Додаємо список з 3 пар до загального списку
        all_pairs.append(list(three_pairs))

    # 3. Викликаємо генератор count_pairs для обробки файлу
    result = count_pairs(FILE, all_pairs)

    # 4. Для кожного рядка виводимо результат підрахунку
    for i, res in enumerate(result, start=1):
        # i – номер рядка
        # res – словник, наприклад {'ab': 2, 'cd': 0, 'ef': 1}
        print(f"Рядок №{i}, пари {all_pairs[i-1]}: {res}")
# Перевірка: якщо файл запускається напряму, то виконуємо main()
# __name__ == '__main__' – стандартна конструкція Python
if __name__ == "__main__":
    main()

